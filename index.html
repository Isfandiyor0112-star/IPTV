<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <title>Isfandiyor's IPTV</title>
  <style>
    body { margin:0; display:flex; font-family:"Segoe UI", sans-serif; height:100vh; background:#1e1e1e; color:#f5f5f5; overflow: hidden; }
    @media (max-width: 768px) {
      body { flex-direction: column; }
      .p-v { width: 100%; height: 56.25vw !important; flex-shrink: 0; position: sticky; top: 0; z-index: 100; background: #000; }
      .s-b { width: 100% !important; flex-grow: 1; height: calc(100vh - 56.25vw); display: flex; flex-direction: column; overflow: hidden; }
    }
    @media (min-width: 769px) {
      .s-b { width: 320px; height: 100vh; border-right: 1px solid #444; display: flex; flex-direction: column; flex-shrink: 0; }
      .p-v { flex: 1; height: 100vh; background: #000; display: flex; flex-direction: column; overflow: hidden; }
    }
    .s-b { background:#2a2a2a; box-sizing: border-box; }
    .s-h { padding: 15px; background: #2a2a2a; }
    .v-c { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #000; position: relative; }
    video { width: 100%; height: 100%; object-fit: contain; }
    .s-c { flex: 1; overflow-y: auto; padding: 0 15px 15px 15px; }
    .cats { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px; }
    .cats button { flex:1; background:#3a3a3a; border:none; color:#f5f5f5; padding:10px; border-radius:6px; cursor:pointer; font-weight: bold; }
    .srch { width:100%; padding:12px; border:none; border-radius:6px; background:#3a3a3a; color:#f5f5f5; box-sizing: border-box; margin-bottom: 10px; }
    .c-l { list-style:none; padding:0; margin:0; }
    .c-l li { cursor:pointer; padding:12px; border-bottom:1px solid #333; display:flex; justify-content:space-between; transition: 0.2s; }
    .c-l li.active { background:#0078d7; font-weight:bold; }
    .a-b { width: 100%; padding: 14px; border: none; border-radius: 12px; cursor: pointer; margin-bottom: 10px; font-weight: 600; background: #0078d7; color: white; display: flex; align-items: center; justify-content: center; }
    .m-d { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); justify-content: center; align-items: center; }
    .m-c { background: #222; padding: 30px; border-radius: 20px; width: 90%; max-width: 320px; text-align: center; position: relative; border: 1px solid #444; }
    #o-v { position:absolute; top:0; left:0; right:0; bottom:0; display:flex; justify-content:center; align-items:center; background:rgba(0,0,0,0.9); color:#fff; z-index:10; text-align:center; padding:20px; }
  </style>
</head>
<body>

  <div class="p-v">
    <div id="o-v">üîê –í–æ–π–¥–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</div>
    <div class="v-c">
      <video id="v-p" controls autoplay playsinline></video>
    </div>
  </div>

  <div class="s-b">
    <div class="s-h">
      <button id="l-i" class="a-b" onclick="_0xOpen()">–í–æ–π—Ç–∏</button>
      <button id="l-o" class="a-b" onclick="signOut()" style="display:none; background:#444;">–í—ã–π—Ç–∏</button>
      <div class="cats">
        <button onclick="_0xLoad('uz')">UZ</button>
        <button onclick="_0xLoad('ru')">RU</button>
        <button onclick="_0xLoad('sport')">–°–ø–æ—Ä—Ç</button>
      </div>
      <input type="text" class="srch" placeholder="–ü–æ–∏—Å–∫..." oninput="_0xFilter(this.value)">
    </div>
    <div class="s-c">
      <ul class="c-l" id="c-list"></ul>
    </div>
  </div>

  <div id="l-m" class="m-d">
    <div class="m-c">
      <span onclick="_0xClose()" style="position:absolute; right:20px; top:10px; cursor:pointer; font-size:24px;">&times;</span>
      <h3>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
      <button class="a-b" onclick="signInWithGoogle()">Google</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <script>
    // --- –ë–õ–û–ö –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ö–ê–ù–ê–õ–û–í  ---
    const _0xList = {
      "uz": [
        { "n": "QXFsdm95", "u": "aHR0cHM6Ly9zdHJlYW05Lml0di51ei90L2VVMWp8MXBEYnJHM1NpTENFSTlxaEEvZS8xNzY0NDIxODU3LzEyMDUvdHJhY2tzLXYxYTEvbW9uby5tM3U4" },
        { "n": "RnV0Ym9sIFRW", "u": "aHR0cHM6Ly9pcHR2LXByb3h5LW0yc20ub25yZW5kZXIuY29tL2NoYW5uZWwvZnV0Ym9sdHZ1ei9pbmRleC5tM3U4" },
        { "n": "Wm8nciBUVg==", "u": "aHR0cHM6Ly9jZG4uaXR2LnV6L3QvdXp0L3pvcl90di9pbmRleC5tM3U4" }
      ]
    };

    const _0xKey = {
      apiKey: "AIzaSyCpC7UxSbtGq3fZ7k4v4yCVDguFu4MU_nI",
      authDomain: "iptv-8b8f9.firebaseapp.com",
      projectId: "iptv-8b8f9",
      storageBucket: "iptv-8b8f9.firebasestorage.app",
      messagingSenderId: "697245556188",
      appId: "1:697245556188:web:a4c8881c17eac1d76b4319"
    };

    firebase.initializeApp(_0xKey);
    const auth = firebase.auth();
    let hls, _0xAct, _0xAll = [], _0xFilt = [];

    const _0xP = {
      ru: "https://raw.githubusercontent.com/Isfandiyor0112-star/m3u8/refs/heads/main/ru.m3u",
      uz: "https://raw.githubusercontent.com/Isfandiyor0112-star/m3u8/refs/heads/main/uz.m3u",
      sport: "https://raw.githubusercontent.com/Isfandiyor0112-star/m3u8/refs/heads/main/sport_https_only.m3u"
    };

    // –û–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    const _0xDec = (e) => window.atob(e);
    function _0xOpen() { document.getElementById("l-m").style.display = "flex"; }
    function _0xClose() { document.getElementById("l-m").style.display = "none"; }

    function _0xLoad(c) {
      const l = document.getElementById('c-list');
      l.innerHTML = '<li>...</li>';
      let loc = (_0xList[c] || []).map(i => ({ n: _0xDec(i.n), u: i.u }));
      
      fetch(_0xP[c] + '?t=' + Date.now())
        .then(r => r.text())
        .then(t => {
          const rem = _0xParse(t);
          const m = new Map();
          [...loc, ...rem].forEach(x => { if(!m.has(x.u)) m.set(x.u, x); });
          _0xAll = Array.from(m.values()).sort((a,b) => a.n.localeCompare(b.n));
          _0xFilt = [..._0xAll];
          _0xRender(_0xFilt);
        }).catch(() => _0xRender(loc));
    }

    function _0xParse(t) {
      const lines = t.split('\n'), res = [];
      let n = '';
      lines.forEach(l => {
        l = l.trim();
        if(l.indexOf('#EXTINF:') > -1) n = l.split(',').pop();
        else if(l.indexOf('http') === 0) { if(n) res.push({n, u: btoa(l)}); n = ''; }
      });
      return res;
    }

    function _0xRender(chs) {
      const l = document.getElementById('c-list');
      l.innerHTML = '';
      const isA = !!auth.currentUser;
      chs.forEach(i => {
        const li = document.createElement('li');
        li.className = i.u === _0xAct ? 'active' : '';
        li.innerHTML = `<span>${i.n}</span><span>${!isA ? 'üîê' : ''}</span>`;
        li.onclick = () => {
          if(!isA) return _0xOpen();
          document.getElementById("o-v").style.display = "none";
          _0xAct = i.u;
          _0xPlay(i.u);
          _0xRender(chs);
        };
        l.appendChild(li);
      });
    }

    function _0xPlay(u) {
      const v = document.getElementById('v-p');
      const d = _0xDec(u);
      if(hls) hls.destroy();
      if(Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(d);
        hls.attachMedia(v);
        hls.on(Hls.Events.MANIFEST_PARSED, () => v.play());
      } else { v.src = d; v.play(); }
    }

    function _0xFilter(q) {
      const f = q.toLowerCase();
      _0xFilt = _0xAll.filter(i => i.n.toLowerCase().includes(f));
      _0xRender(_0xFilt);
    }

    function signInWithGoogle() {
      auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(() => _0xClose());
    }
    function signOut() { auth.signOut(); }

    auth.onAuthStateChanged(u => {
      document.getElementById("l-i").textContent = u ? (u.displayName || "–ü—Ä–æ—Ñ–∏–ª—å") : "–í–æ–π—Ç–∏";
      document.getElementById("l-o").style.display = u ? "block" : "none";
      document.getElementById("o-v").style.display = u ? "none" : "flex";
      _0xRender(_0xFilt);
    });

    window.onload = () => _0xLoad('uz');
  </script>
</body>
</html>

